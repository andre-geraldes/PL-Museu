%
% Layout retirado de http://www.di.uminho.pt/~prh/curplc09.html#notas
%
\documentclass{report}
\usepackage[portuges]{babel}
%\usepackage[utf8]{inputenc}
\usepackage[latin1]{inputenc}
\usepackage{graphicx}

\usepackage{url}
%\usepackage{alltt}
%\usepackage{fancyvrb}
\usepackage{listings}
%LISTING - GENERAL
\lstset{
	basicstyle=\small,
	numbers=left,
	numberstyle=\tiny,
	numbersep=5pt,
	breaklines=true,
    frame=tB,
	mathescape=true,
	escapeinside={(*@}{@*)}
}
%
%\lstset{ %
%	language=Java,							% choose the language of the code
%	basicstyle=\ttfamily\footnotesize,		% the size of the fonts that are used for the code
%	keywordstyle=\bfseries,					% set the keyword style
%	%numbers=left,							% where to put the line-numbers
%	numberstyle=\scriptsize,				% the size of the fonts that are used for the line-numbers
%	stepnumber=2,							% the step between two line-numbers. If it's 1 each line
%											% will be numbered
%	numbersep=5pt,							% how far the line-numbers are from the code
%	backgroundcolor=\color{white},			% choose the background color. You must add \usepackage{color}
%	showspaces=false,						% show spaces adding particular underscores
%	showstringspaces=false,					% underline spaces within strings
%	showtabs=false,							% show tabs within strings adding particular underscores
%	frame=none,								% adds a frame around the code
%	%abovecaptionskip=-.8em,
%	%belowcaptionskip=.7em,
%	tabsize=2,								% sets default tabsize to 2 spaces
%	captionpos=b,							% sets the caption-position to bottom
%	breaklines=true,						% sets automatic line breaking
%	breakatwhitespace=false,				% sets if automatic breaks should only happen at whitespace
%	title=\lstname,							% show the filename of files included with \lstinputlisting;
%											% also try caption instead of title
%	escapeinside={\%*}{*)},					% if you want to add a comment within your code
%	morekeywords={*,...}					% if you want to add more keywords to the set
%}

\usepackage{xspace}

\parindent=0pt
\parskip=2pt

\def\darius{\textsf{Darius}\xspace}
\def\java{\texttt{Java}\xspace}

\title{Processamento de Linguagens\\ (3º ano de Licenciatura em Engenharia Informática)\\ \textbf{Trabalho Prático 1}\\ Relatório de Desenvolvimento}
\author{André Gerlades (67673) \and Patrícia Barros (67665) \and Sandra Ferreira (67709)}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
Este relatório descreve todo o processo de desenvolvimento e decisões tomadas para a realização do primeiro trabalho prático da Unidade Curricular de Processamento de Linguagens.\\ O problema a resolver consiste no desenvolvimento de um Filtro de Texto, utilizando Flex, para processar ficheiros XML com informações sobre fotografias e gerar um álbum HTML a partir delas.

\end{abstract}

\tableofcontents

\chapter{Introdução} \label{intro}


A resolução deste trabalho prático passa pelo desenvolvimento de um Filtro de Texto em Flex para gerar ficheiros em HTML. Para isso utilizamos as técnicas leccionadas nas aulas da Unidade Curricular de Processamento de Linguagens. Pretendemos portanto com este trabalho aprimorar as nossas capacidades de escrever \emph{Expressões Regulares (ER)} e também a nossa experiência na utilização da linguagem de programação C.\\ Neste relatório apresentamos todos os passos e decisões tomadas durante todo o processo, descrevemos as estruturas criadas para guardar o texto extraído pelo filtro e também uma descrição do produto final (em HTML) obtido com a utilização do filtro criado por nós.


\section*{Estrutura do Relatório} \
A elaboração deste documento teve por base a estrutura do relatório fornecida pelo docente. \\
O relatório encontra-se então estruturado da seguinte forma: possuí um primeiro capítulo que faz uma contextualização ao assunto tratado neste trabalho, seguindo-se uma introdução onde são apresentadas as metas de aprendizagem pertendidas.\\
Posteriormente é exposto o tema escolhido para desenvolver o trabalho e as tarefas que nele estão envolvidas.\\
Imediatamente após, são exibidas as expressões regulares definidas para extrair do ficheiro XML as informações para a construção da página HTML, mostrando também os estados da aplicação e os módulos desta.\\
Não menos importante, seguem-se os capitulos de apresentação das estruturas de dados usadas no desenvolvimento do trabalho e dos testes realizados à aplicação com os devidos resultados.
Por último, faz-se uma análise crítica relativa quer ao desenvolvimento do projeto quer ao seu estado final e ainda é feita uma abordagem ao trabalho futuro.

\chapter{Análise e Especificação} \label{ae}
\section{Descrição informal do problema}
Dos enunciados propostos o que escolhemos seguir foi o "Museu da Pessoa - tratamento de fotografias". \\Neste enunciado foi-nos pedido que realizassemos um Filtro de Texto em Flex para, através de um ficheiro XML com informações (onde,quando,quem e facto) sobre fotografias que fazem parte do Museu da Pessoa, gerar um álbum em HTML em que sejam mostradas as fotografias em questão, por ordem cronológica, sendo que o título de cada fotografia será o campo "facto". Foi-nos ainda pedido que apresentássemos um índice no ínicio com o nome de todas as pessoas retratadas.

\chapter{Concepção/desenho da Resolução}
Para a resolução do problema foi necessário definirmos \emph{Expressões Regulares}, estados no Flex e ainda estruturas de dados para guardar a informação filtrada. Nos próximos capítulos iremos descrever detalhadamente cada um destes pontos.
\section{Expressões Regulares}
As expressões regulares definidas visam extrair do ficheiro XML as informações necessárias para a construção da página HTML: foto, quando, onde, quem e facto. Após analisar cuidadosamente a estrutura dos ficheiros XML em questão chegamos às seguintes \emph{Expressões Regulares}:\\ \textbf{QUEM} "<"(?i:QUEM)">" \\ \textbf{FACTO} "<"(?i:FACTO)">" \\ \textbf{FOTO} "<"(?i:FOTO)" "(?i:FICHEIRO)"=\"" \\ \textbf{QUANDO} "<"(?i:QUANDO)" "(?i:DATA)"=\"" \\ 

\section{Estados da Aplicação}
\textbf{Estado QUEM}\\
Quando é encontarada a palavra "QUEM" são guardadas as palavras seguintes, com o devido tratamento dado pela função trim definida, uma vez que estas serão referentes a quem pertence a foto.
\begin{verbatim}
"<"(?i:QUEM)">" 					{ BEGIN QUEM1; }
<QUEM1>"<"	 						{ BEGIN INITIAL; } 
<QUEM1>[^<]+						{ quem = strdup(yytext); quem = trim(quem); }
\end{verbatim}

\textbf{Estado FACTO}\\
Quando é identificada a expressão "FACTO" é guardada a informação que a esta se segue, através da função\textit{ strdup}.
\begin{verbatim}
"<"(?i:FACTO)">"					{ BEGIN FACTO1; }
<FACTO1>"<"	 						{ BEGIN INITIAL; } 
<FACTO1>[^<]+	 					{ facto = strdup(yytext); }
\end{verbatim}

\textbf{Estado QUANDO}\\
Aquando da análise léxica, se for detetada a palavra "QUANDO" a data a esta referente é guardada. Posteriormente é chamada a função breakFoto que recebe como parâmetro a string guardada e converte-a num tipo de dados \textit{struct data}. 
\begin{verbatim}
"<"(?i:QUANDO)" "(?i:DATA)"=\""		{ BEGIN QUANDO1; }
<QUANDO1>"\""						{ BEGIN INITIAL; } 
<QUANDO1>[^\"]+ 					{ quando = strdup(yytext); 
da = breakFoto(quando); }
\end{verbatim}

\textbf{Estado FOTO} \\
Encontrada a palavra "FOTO" é criado um novo nodo na lista ligada que contêm a informação referentes a outras fotos. Depois de inserido o novo nodo, a lista é ordenada pela data das fotos.
\begin{verbatim}
"<"(?i:FOTO)" "(?i:FICHEIRO)"=\""	{ BEGIN FOTO1; }
<FOTO1>"\""	 						{ BEGIN INITIAL; } 
<FOTO1>[^\"]+						{ foto = strdup(yytext); 
nodo = novoNodo(da, foto, quem, facto);
sortedInsert(&dados, nodo);
}
\end{verbatim}

\section{Módulos da Aplicação}
\textbf{makefile} Ficheiro com a configuração de compilação.\\
\textbf{parser.l} Ficheiro com código necessário para fazer o processamento dos ficheiros XML que contêm a informação. \\
\textbf{listaligada.h} Ficheiro que contém o código necessário à implementação de uma lista ligada e das funções necessárias para a sua manipulação. \\
\textbf{dados.h} Ficheiro onde se encontra a estrutura definida para guardar a data das fotos. \\
\textbf{html.h} Ficheiro com o código que gera as páginas em HTML.

\section{Estruturas de Dados}
Dado ser necessário guradar alguns dados, a estutura de dados escolhida foi a lista ligada. Esta estrutura possui um campo para guardar a data da fotografia, o facto, breve descrição da foto, o nome do ficheiro da foto e por último, um campo quem, que se destina a guardar os nomes das pessoas retratadas.

\begin{lstlisting}[language=C]
struct data {
	int ano;
	int mes;
	int dia:
};

struct listaLigada {
	struct data datay;
	char *nome;
	char *quem;
	char *fato;
	struct listaLigada * next;
};
\end{lstlisting}


\chapter{Codificação e Testes}

\section{Alternativas, Decisões e Problemas de Implementação}
No decorrer do desenvolvimento do projeto verificamos que nem todas as fotos eram possuidoras do campo "FACTO", campo este que deveria ser o cabeçalho das fotos. Embora tenha sido pedido no enunciado que utilizassemos este como cabeçalho o grupo decidiu que seria melhor se ao invés se colocasse o campo "QUEM" como cabeçalho.
 
\section{Testes realizados e Resultados}
São apresentadas de seguida, imagens que mostram o resultado do filtro de texto elaborado pelo grupo para os diversos casos.

\begin{figure}[h]
	\includegraphics[width=10cm]{imagens/testeAntonioMachado.png}
	\centering
	\caption{Resultado do filtro de testo para o caso do António Machado}
\end{figure}

\begin{figure}[h]
	\includegraphics[width=10cm]{imagens/teste2MariaCeleste.png}
	\centering
	\caption{Resultado do filtro de testo para o caso do José de Oliveira Dias}
\end{figure}

\begin{figure}[h]
	\includegraphics[width=10cm]{imagens/testeMariaCeleste.png}
	\centering
	\caption{Resultado do filtro de testo para o caso da Maria Celeste}
\end{figure}

\begin{figure}[h]
	\includegraphics[width=10cm]{imagens/testeTabernadoFausto.png}
	\centering
	\caption{Resultado do filtro de testo para o caso Taberna do Fausto}
\end{figure}

%\VerbatimInput{teste1.txt}


\chapter{Conclusão} \label{concl}
A realização deste projeto foi fundamental para se consolidar a matéria leccionada quer nas aulas práticas quer nas aula teóricas, uma vez que as técnicas de utilização de expressões regulares aí aprendidas facilitou a implementação do problema. Estas técnicas pertimitiram recolher de forma eficiente e clara as informações pertendidas.\\
Foi ainda possível ao grupo aprender a trabalhar com o básico da linguagem HTML que nunca tinha sido utilizada por qualquer dos elementos.
O projeto  "Museu da Pessoa - tratamento de fotografias" foi muito enriquecedor, dado que obrigou a dedicar um porção de tempo e a refinar as qualidades do grupo na utilização do Flex e na construção das expressões regulares.

\appendix
\chapter{Código Flex}
\lstinputlisting{parser.l} %input de um ficheiro
\chapter{Código da Lista Ligada}
\lstinputlisting{listaligada.c}
\chapter{Código para gerar o HTML}
\lstinputlisting{html.c}











\end{document} 